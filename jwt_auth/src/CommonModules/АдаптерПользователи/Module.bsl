Функция UUIDПоСсылке(Знач ВводПользователя) Экспорт
	
	Если ВводПользователя = Неопределено Тогда
		ОшибкиПриложения.ОшибкаДанных(
		"Не выбран пользователь.",
		"USER.BAD_INPUT.NO_USER",
		Новый Структура("Поле", "Пользователь")
		);
	КонецЕсли;
	
	// Если это ссылочный тип — у него есть метод УникальныйИдентификатор()
	// (для большинства ссылок метаданных). 
	Попытка
		Попытка
			Если ВводПользователя.Пустая() Тогда
				ОшибкиПриложения.ОшибкаДанных(
				"Пользователь не выбран.",
				"USER.BAD_INPUT.USER_EMPTY",
				Новый Структура("Поле", "Пользователь")
				);
			КонецЕсли;
		Исключение
			// нет метода Пустая — ок, идём дальше
		КонецПопытки;
		
		Возврат ВводПользователя.УникальныйИдентификатор();
		
	Исключение
		ОшибкиПриложения.ОшибкаДанных(
			"Некорректное значение 'Пользователь' (ожидается ссылка на пользователя).",
			"USER.BAD_INPUT.USER_BAD_FORMAT",
			Новый Структура("Тип", Строка(ТипЗнч(ВводПользователя))),
			ИнформацияОбОшибке()
		);
	КонецПопытки;
	
КонецФункции

Функция СсылкаПоUUID(Знач UUIDПользователя) Экспорт
	// Нормализуй UUID как УникальныйИдентификатор
	Если ТипЗнч(UUIDПользователя) = Тип("Строка") Тогда
		UUIDПользователя = Новый УникальныйИдентификатор(UUIDПользователя);
	КонецЕсли;
	
	Если ТипЗнч(UUIDПользователя) <> Тип("УникальныйИдентификатор") Тогда
		ОшибкиПриложения.ОшибкаИспользования(
			"Некорректный UUID пользователя.",
			"USER.BAD_UUID",
			Новый Структура("Тип", Строка(ТипЗнч(UUIDПользователя)))
		);
	КонецЕсли;
	
	Пользователь = Справочники.Пользователи.ПолучитьСсылку(UUIDПользователя);
	
	Если Пользователь.Пустая() Тогда
		ОшибкиПриложения.ОшибкаИспользования(
			"Пользователь не найден по идентификатору.",
			"USER.NOT_FOUND",
			Новый Структура("UUID", UUIDПользователя)
		);
	КонецЕсли;
	
	Возврат Пользователь;
КонецФункции

Функция НайтиПоКлючуИБ(Знач Ключ) Экспорт
	Пользователь = Справочники.Пользователи.НайтиПоРеквизиту("КлючПользователяИБ", Ключ);
	
	Если Пользователь.Пустая() Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	Возврат UUIDПоСсылке(Пользователь);
КонецФункции

Функция ЗаписатьУИДПользователяИБ(Знач ПользовательИД, Знач УИДПользователяИБ) Экспорт
	Пользователь = СсылкаПоUUID(ПользовательИД).ПолучитьОбъект();
	Пользователь.КлючПользователяИБ = УИДПользователяИБ;
	Пользователь.Записать();
КонецФункции






