
Функция ТребоватьКонтекст(Знач ВходАвторизации, Знач ТребуемыеОбласти, Знач Порты) Экспорт
	ПроверитьВходАвторизации(ВходАвторизации);
	
	// 1) Аутентификация
	Субъект = МаршрутизаторАутентификации.Аутентифицировать(ВходАвторизации, Порты);
	
	// 2) Авторизация (scopes) + сбор контекста
	Контекст = СценарийПостроениеКонтекстаДоступа.ВыполнитьСценарий(Субъект, ТребуемыеОбласти, ВходАвторизации, Порты);
	
	Возврат Контекст;
КонецФункции

Процедура ПроверитьВходАвторизации(Знач ВходАвторизации)
	Если ТипЗнч(ВходАвторизации) <> Тип("Структура") Тогда
		ОшибкиПриложения.ОшибкаКонфигурации(
			"Ошибка доступа: вход авторизации должен быть структурой.",
			"API.Конфигурация.НекорректныйВходАвторизации"
		);
	КонецЕсли;

	Если Не ВходАвторизации.Свойство("СтрокаАвторизации") Тогда
		ОшибкиПриложения.ОшибкаКонфигурации(
			"Ошибка доступа: не задана строка авторизации.",
			"API.Конфигурация.НекорректныйВходАвторизации"
		);
	КонецЕсли;

	ТекущееВремя = Неопределено;
	Если Не ВходАвторизации.Свойство("ТекущееВремяUTC", ТекущееВремя) Тогда
		ОшибкиПриложения.ОшибкаКонфигурации(
			"Ошибка доступа: не задано текущее время (UTC).",
			"API.Конфигурация.НекорректныйВходАвторизации"
		);
	КонецЕсли;

	Если ТипЗнч(ТекущееВремя) <> Тип("Дата") Тогда
		ОшибкиПриложения.ОшибкаКонфигурации(
			"Ошибка доступа: текущее время должно быть датой (UTC).",
			"API.Конфигурация.НекорректныйВходАвторизации"
		);
	КонецЕсли;
КонецПроцедуры
