// Тест_АдаптерКриптография1С

Процедура ИсполняемыеСценарии() Экспорт
	ЮТТесты
		.ДобавитьТестовыйНабор("АдаптерКриптография1С", "Security,Crypto,Hash")
			// SHA256Hex
			.ДобавитьСерверныйТест("SHA256Hex_ПустаяСтрока_Эталон")
			.ДобавитьСерверныйТест("SHA256Hex_ABC_Эталон")
			.ДобавитьСерверныйТест("SHA256Hex_UnicodeПривет_Эталон")
			.ДобавитьСерверныйТест("SHA256Hex_НестрочноеЧисло_КакСтрока")
			.ДобавитьСерверныйТест("SHA256Hex_Длина64_И_НижнийРегистр")

			// SHA1Base64
			.ДобавитьСерверныйТест("SHA1Base64_ПустаяСтрока_Эталон")
			.ДобавитьСерверныйТест("SHA1Base64_ABC_Эталон")
			.ДобавитьСерверныйТест("SHA1Base64_UnicodeПривет_Эталон")
			.ДобавитьСерверныйТест("SHA1Base64_НестрочноеЧисло_КакСтрока")
			.ДобавитьСерверныйТест("SHA1Base64_Длина28")
	;
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// SHA256Hex
////////////////////////////////////////////////////////////////////////////////

Процедура SHA256Hex_ПустаяСтрока_Эталон() Экспорт
	// SHA-256("") =
	// e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
	Ожидаемо = "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";

	Факт = АдаптерКриптография1С.SHA256Hex("");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт))
		.Свойство("Значение").Равно(Ожидаемо);
КонецПроцедуры


Процедура SHA256Hex_ABC_Эталон() Экспорт
	// SHA-256("abc") =
	// ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad
	Ожидаемо = "ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad";

	Факт = АдаптерКриптография1С.SHA256Hex("abc");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт))
		.Свойство("Значение").Равно(Ожидаемо);
КонецПроцедуры


Процедура SHA256Hex_UnicodeПривет_Эталон() Экспорт
	// SHA-256("привет") при UTF-8 =
	// e58f1e8c55fa105bdd3f40e5037eb0b039b5998d52c05e6cd98878dd2da5cab2
	Ожидаемо = "e58f1e8c55fa105bdd3f40e5037eb0b039b5998d52c05e6cd98878dd2da5cab2";

	Факт = АдаптерКриптография1С.SHA256Hex("привет");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт))
		.Свойство("Значение").Равно(Ожидаемо);
КонецПроцедуры


Процедура SHA256Hex_НестрочноеЧисло_КакСтрока() Экспорт
	// Внутри: Строка(Данные), значит 123 == "123"
	Факт1 = АдаптерКриптография1С.SHA256Hex(123);
	Факт2 = АдаптерКриптография1С.SHA256Hex("123");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт1))
		.Свойство("Значение").Равно(Факт2);
КонецПроцедуры


Процедура SHA256Hex_Длина64_И_НижнийРегистр() Экспорт
	Факт = АдаптерКриптография1С.SHA256Hex("abc");

	ЮТест.ОжидаетЧто(Новый Структура("Длина", СтрДлина(Факт)))
		.Свойство("Длина").Равно(64);

	// Проверка, что уже в нижнем регистре (функция делает НРег)
	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт))
		.Свойство("Значение").Равно(НРег(Факт));
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// SHA1Base64
////////////////////////////////////////////////////////////////////////////////

Процедура SHA1Base64_ПустаяСтрока_Эталон() Экспорт
	// SHA-1("") (20 байт) в Base64 = 2jmj7l5rSw0yVb/vlWAYkK/YBwk=
	Ожидаемо = "2jmj7l5rSw0yVb/vlWAYkK/YBwk=";

	Факт = АдаптерКриптография1С.SHA1Base64("");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт))
		.Свойство("Значение").Равно(Ожидаемо);
КонецПроцедуры


Процедура SHA1Base64_ABC_Эталон() Экспорт
	// SHA-1("abc") в Base64 = qZk+NkcGgWq6PiVxeFDCbJzQ2J0=
	Ожидаемо = "qZk+NkcGgWq6PiVxeFDCbJzQ2J0=";

	Факт = АдаптерКриптография1С.SHA1Base64("abc");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт))
		.Свойство("Значение").Равно(Ожидаемо);
КонецПроцедуры


Процедура SHA1Base64_UnicodeПривет_Эталон() Экспорт
	// SHA-1("привет") при UTF-8 в Base64 = 4kUF+U2ytd9MfCWWsHiOcg4HMCE=
	Ожидаемо = "4kUF+U2ytd9MfCWWsHiOcg4HMCE=";

	Факт = АдаптерКриптография1С.SHA1Base64("привет");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт))
		.Свойство("Значение").Равно(Ожидаемо);
КонецПроцедуры


Процедура SHA1Base64_НестрочноеЧисло_КакСтрока() Экспорт
	Факт1 = АдаптерКриптография1С.SHA1Base64(123);
	Факт2 = АдаптерКриптография1С.SHA1Base64("123");

	ЮТест.ОжидаетЧто(Новый Структура("Значение", Факт1))
		.Свойство("Значение").Равно(Факт2);
КонецПроцедуры


Процедура SHA1Base64_Длина28() Экспорт
	Факт = АдаптерКриптография1С.SHA1Base64("abc");

	// SHA1 digest 20 байт => Base64 всегда 28 символов (с '=' в конце)
	ЮТест.ОжидаетЧто(Новый Структура("Длина", СтрДлина(Факт)))
		.Свойство("Длина").Равно(28);
КонецПроцедуры